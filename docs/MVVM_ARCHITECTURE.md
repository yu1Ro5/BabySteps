# BabySteps - 機能設計書

## 概要

BabyStepsは、画像のコンセプト「タスクのステップ分解と進捗可視化」を実現するiOSアプリケーションです。大きなタスクを小さなステップに分解し、各ステップの完了ごとに進捗を可視化することで、ユーザーが継続的にタスクに取り組めるようにします。

## 実装された機能一覧

### 1. タスク管理機能
- タスクの作成・削除
- タスクタイトルの編集
- タスク一覧の表示

### 2. ステップ管理機能
- タスクへのステップ追加
- ステップの完了状態管理（チェックボックス）
- ステップの削除
- ステップタイトルの編集

### 3. 進捗可視化機能
- 個別タスクの進捗率表示
- 全体進捗率の表示
- プログレスバーによる視覚的表現
- 完了済みステップ数の表示

## 画面設計

### メイン画面（TaskListView）

#### レイアウト構成
```
┌─────────────────────────────────────┐
│ BabySteps                    [+ボタン] │
├─────────────────────────────────────┤
│ 全体進捗                              │
│ [████████░░] 80%                    │
├─────────────────────────────────────┤
│ タスク一覧                            │
│ ┌─────────────────────────────────┐ │
│ │ 問題集をやる                    │ │
│ │ [████░░░░] 3/5                 │ │
│ │ ☐ 第1章の問題を解く            │ │
│ │ ☐ 第2章の問題を解く            │ │
│ │ ☑ 第3章の問題を解く            │ │
│ │ ☐ 第4章の問題を解く            │ │
│ │ ☐ 第5章の問題を解く            │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 掃除をする                      │ │
│ │ [██░░░░░░] 1/4                 │ │
│ │ ☑ 机の上を片付ける            │ │
│ │ ☐ 床を掃除する                │ │
│ │ ☐ ゴミを捨てる                │ │
│ │ ☐ 整理整頓する                │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### UIコンポーネント詳細

**1. 全体進捗表示（Overall Progress View）**
- 位置: 画面最上部
- 表示内容: "全体進捗"ラベル + プログレスバー + パーセンテージ
- スタイル: グレー背景、角丸、パディング付き

**2. タスク一覧（Task List）**
- 表示形式: List形式
- 各タスク: カード形式の表示
- 削除機能: スワイプ削除対応

**3. タスク行（Task Row）**
- タスクタイトル: ヘッドライン形式
- 進捗表示: プログレスバー + 完了数/総数
- ステップ一覧: チェックボックス付きリスト
- ステップ追加: プラスボタン

### タスク追加画面（Add Task Sheet）

#### レイアウト構成
```
┌─────────────────────────────────────┐
│ タスク追加                    [キャンセル] │
├─────────────────────────────────────┤
│                                     │
│ 新しいタスクを作成                   │
│                                     │
│ [タスクのタイトルを入力]             │
│                                     │
│ [作成]                              │
│                                     │
└─────────────────────────────────────┘
```

#### 機能仕様
- モーダル表示（Sheet）
- タイトル入力フィールド
- 作成ボタン（入力値が空の場合は無効化）
- キャンセルボタン

### ステップ追加画面（Add Step Sheet）

#### レイアウト構成
```
┌─────────────────────────────────────┐
│ ステップ追加                  [キャンセル] │
├─────────────────────────────────────┤
│                                     │
│ 「問題集をやる」にステップを追加      │
│                                     │
│ [ステップのタイトルを入力]           │
│                                     │
│ [追加]                              │
│                                     │
└─────────────────────────────────────┘
```

#### 機能仕様
- モーダル表示（Sheet）
- 対象タスク名の表示
- ステップタイトル入力フィールド
- 追加ボタン（入力値が空の場合は無効化）
- キャンセルボタン

## データ設計

### データモデル

#### Task（タスク）
```swift
@Model
final class Task {
    var id: UUID           // 一意識別子
    var title: String      // タスクタイトル
    var createdAt: Date    // 作成日時
    var steps: [TaskStep]  // ステップ配列
    
    // 計算プロパティ
    var progress: Double   // 進捗率（0.0-1.0）
    var completedStepsCount: Int  // 完了ステップ数
    var totalStepsCount: Int      // 全ステップ数
}
```

#### TaskStep（タスクステップ）
```swift
@Model
final class TaskStep {
    var id: UUID           // 一意識別子
    var title: String      // ステップタイトル
    var isCompleted: Bool  // 完了状態
    var order: Int         // 順序
    var task: Task?        // 親タスクへの参照
}
```

### データ永続化

- **フレームワーク**: SwiftData
- **永続化方式**: ローカルストレージ
- **データ形式**: 構造化データ（リレーショナル）
- **同期方式**: リアルタイム同期

## ビジネスロジック

### 進捗計算ロジック

#### 個別タスク進捗
```swift
var progress: Double {
    guard !steps.isEmpty else { return 0.0 }
    let completedSteps = steps.filter { $0.isCompleted }.count
    return Double(completedSteps) / Double(steps.count)
}
```

#### 全体進捗
```swift
func getOverallProgress() throws -> Double {
    let tasks = try fetchTasks()
    guard !tasks.isEmpty else { return 0.0 }
    
    let totalProgress = tasks.reduce(0.0) { $0 + $1.progress }
    return totalProgress / Double(tasks.count)
}
```

### データ操作ロジック

#### タスク作成
1. タイトル検証（空文字チェック）
2. Taskインスタンス作成
3. ModelContextに挿入
4. 永続化

#### ステップ追加
1. ステップタイトル検証
2. 順序番号の自動割り当て
3. TaskStepインスタンス作成
4. 親タスクとの関連付け
5. 永続化

#### ステップ完了
1. 完了状態の切り替え
2. 進捗率の自動再計算
3. UIの自動更新

## ユーザー操作フロー

### 1. タスク作成フロー
```
1. メイン画面の[+]ボタンをタップ
2. タスク追加画面が表示
3. タスクタイトルを入力
4. [作成]ボタンをタップ
5. タスクが作成され、一覧に表示
```

### 2. ステップ追加フロー
```
1. タスク行の[+]ボタンをタップ
2. ステップ追加画面が表示
3. ステップタイトルを入力
4. [追加]ボタンをタップ
5. ステップが追加され、チェックボックス付きで表示
```

### 3. ステップ完了フロー
```
1. ステップのチェックボックスをタップ
2. チェックマークが表示される
3. 進捗率が自動更新される
4. プログレスバーが更新される
```

### 4. タスク削除フロー
```
1. タスク行を左にスワイプ
2. 削除ボタンが表示される
3. 削除ボタンをタップ
4. タスクと関連ステップが削除される
```

## 技術仕様

### 開発環境
- **言語**: Swift 5.9+
- **フレームワーク**: SwiftUI, SwiftData
- **ターゲット**: iOS 18.0+
- **アーキテクチャ**: MVVM

### 使用ライブラリ
- **SwiftUI**: UI構築
- **SwiftData**: データ永続化
- **Foundation**: 基本機能

### パフォーマンス要件
- タスク一覧表示: 100件以内で1秒以内
- 進捗計算: リアルタイム（100ms以内）
- データ保存: 1秒以内

## 制約事項

### 現在の制限
- タスク数: 制限なし（実用上1000件程度）
- ステップ数: タスクあたり制限なし（実用上50件程度）
- 文字数: タイトル100文字以内
- データ形式: テキストのみ

### 将来的な制限解除
- 画像・ファイル添付
- カテゴリ分類
- 期限設定
- 通知機能

## エラーハンドリング

### 入力値検証
- 空文字チェック
- 文字数制限チェック
- 特殊文字フィルタリング

### データ整合性
- 親子関係の整合性チェック
- 順序番号の重複チェック
- 削除時の関連データ処理

### 永続化エラー
- 保存失敗時のロールバック
- ネットワークエラー時のローカル保存
- データ破損時の復旧処理

## テスト仕様

### 単体テスト
- 進捗計算ロジック
- データ操作ロジック
- 入力値検証ロジック

### 統合テスト
- タスク作成から削除までの一連フロー
- ステップ追加から完了までの一連フロー
- データ永続化の一連フロー

### UIテスト
- 画面遷移の動作確認
- ユーザー操作の動作確認
- 表示内容の正確性確認

## 今後の拡張予定

### 短期（1-2ヶ月）
- タスク編集機能
- ステップ順序変更機能
- データエクスポート機能

### 中期（3-6ヶ月）
- カテゴリ分類機能
- 期限管理機能
- 統計・分析機能

### 長期（6ヶ月以上）
- クラウド同期機能
- チーム共有機能
- AI支援機能

## まとめ

BabyStepsは、画像のコンセプト「タスクのステップ分解と進捗可視化」を完全に実現するiOSアプリケーションです。SwiftUI + SwiftData + MVVMアーキテクチャにより、保守性・拡張性・パフォーマンスを確保しながら、ユーザーが継続的にタスクに取り組める直感的なインターフェースを提供します。

### 主要な特徴
1. **直感的なUI**: チェックボックスによる進捗管理
2. **リアルタイム更新**: 進捗率の自動計算と表示
3. **効率的なデータ管理**: SwiftDataによる最適化された永続化
4. **拡張可能な設計**: MVVMアーキテクチャによる保守性