# TaskList タスクタブ仕様書

## 📋 概要

TaskListタブは、BabyStepsアプリのメイン機能であるタスク管理を提供する画面です。ユーザーはタスクを作成し、各タスクに複数のステップを追加して、段階的に目標を達成できるよう設計されています。

## 🏗️ アーキテクチャ

### MVVM (Model-View-ViewModel) パターン

- **View**: `TaskListView.swift` - UI表示とユーザーインタラクション
- **ViewModel**: `TaskViewModel.swift` - ビジネスロジックとデータ操作
- **Model**: `Task.swift`, `TaskStep.swift` - データ構造とビジネスルール

### 依存関係

```
TaskListView → TaskViewModel → Task/TaskStep (SwiftData)
                ↓
            ActivityViewModel (アクティビティ更新通知)
```

## 📱 UI構成

### 1. ヘッダー部分
- **ナビゲーションバー**: "BabySteps" タイトル
- **追加ボタン**: 新規タスク作成（+アイコン）

### 2. 全体進捗表示
- **進捗バー**: 全タスクの完了率を視覚的に表示
- **進捗率**: パーセンテージ表示（例：75%）

### 3. タスク一覧
- **タスク行**: 各タスクの基本情報とステップ表示
- **削除機能**: スワイプでタスク削除
- **ステップ追加**: 各タスク行にステップ追加ボタン

## 🔧 主要機能

### タスク管理
- **新規作成**: タスクタイトルの入力
- **編集**: タスクタイトルの変更
- **削除**: スワイプアクションによる削除
- **表示**: 作成日時、進捗率、ステップ数

### ステップ管理
- **追加**: タスク内にステップを追加
- **完了/未完了**: チェックボックスによる状態切り替え
- **順序**: ステップの実行順序を管理
- **完了日時**: 完了時に自動記録

### 進捗管理
- **個別進捗**: 各タスクの完了率計算
- **全体進捗**: 全タスクの総合完了率
- **リアルタイム更新**: ステップ完了時に自動更新

## 📊 データモデル

### Task エンティティ
```swift
@Model
final class Task {
    var id: UUID           // 一意識別子
    var title: String      // タスクタイトル
    var createdAt: Date    // 作成日時
    var steps: [TaskStep]  // ステップ一覧
}
```

### TaskStep エンティティ
```swift
@Model
final class TaskStep {
    var id: UUID           // 一意識別子
    var title: String      // ステップタイトル
    var isCompleted: Bool  // 完了状態
    var order: Int         // 実行順序
    var task: Task?        // 親タスクへの参照
    var completedAt: Date? // 完了日時
}
```

## 🔄 データフロー

### 1. 初期化フロー
```
アプリ起動 → ModelContext初期化 → 既存データ読み込み → UI表示
```

### 2. タスク作成フロー
```
ユーザー入力 → バリデーション → Task作成 → SwiftData保存 → UI更新
```

### 3. ステップ完了フロー
```
ステップ完了 → 完了日時記録 → 進捗率計算 → アクティビティ更新 → UI更新
```

### 4. 削除フロー
```
削除アクション → 関連データ削除 → SwiftData保存 → UI更新
```

## 🎯 ビジネスロジック

### 進捗率計算
```swift
var progress: Double {
    guard !steps.isEmpty else { return 0.0 }
    let completedSteps = steps.filter { $0.isCompleted }.count
    return Double(completedSteps) / Double(steps.count)
}
```

### ステップ完了処理
```swift
func toggleCompletion() {
    isCompleted.toggle()
    if isCompleted {
        completedAt = Date()
    } else {
        completedAt = nil
    }
}
```

## 🔗 連携機能

### アクティビティ連携
- **通知メカニズム**: `onActivityUpdate` コールバック
- **更新タイミング**: タスク/ステップの状態変更時
- **データ同期**: ActivityViewModelへの自動通知

### SwiftData連携
- **永続化**: 自動的なデータベース保存
- **クエリ**: `@Query` によるリアルタイム更新
- **コンテキスト**: ModelContextによるデータ操作

## 📱 ユーザーインタラクション

### タッチ操作
- **タップ**: タスク選択、ステップ完了切り替え
- **スワイプ**: タスク削除
- **長押し**: 将来的な編集機能（実装予定）

### フォーム入力
- **タスク作成**: モーダルシートでのタイトル入力
- **ステップ追加**: モーダルシートでのタイトル入力
- **バリデーション**: 空文字列チェック

## 🎨 UI/UX設計

### デザイン原則
- **シンプル**: 必要最小限の情報表示
- **直感的**: 分かりやすい操作フロー
- **視覚的**: 進捗バーによる進捗の可視化

### アクセシビリティ
- **VoiceOver対応**: 各要素の適切な説明
- **Dynamic Type**: フォントサイズの自動調整
- **コントラスト**: 十分な色のコントラスト比

## 🚀 パフォーマンス

### 最適化戦略
- **遅延読み込み**: 必要時のみデータ取得
- **効率的な更新**: 変更された部分のみ更新
- **メモリ管理**: 適切な参照管理

### 制限事項
- **最大タスク数**: 実装上の制限なし
- **最大ステップ数**: 実装上の制限なし
- **データサイズ**: SwiftDataの制限に依存

## 🔮 将来の拡張

### 計画中の機能
- **タスク編集**: 既存タスクのタイトル変更
- **ステップ編集**: ステップタイトルの変更
- **カテゴリ**: タスクの分類機能
- **優先度**: タスクの優先度設定
- **期限**: タスクの期限設定

### 技術的改善
- **オフライン対応**: ネットワーク不要での動作
- **データエクスポート**: 進捗データの外部出力
- **バックアップ**: データの自動バックアップ

## 📝 開発者向け情報

### ファイル構成
```
Sources/
├── Views/
│   └── TaskListView.swift      # メイン画面
├── ViewModels/
│   └── TaskViewModel.swift     # ビジネスロジック
└── Models/
    └── Task.swift              # データモデル
    └── TaskStep.swift          # ステップモデル
```

### テスト戦略
- **Unit Tests**: ViewModel、Modelのロジック
- **UI Tests**: ユーザー操作フロー
- **Integration Tests**: SwiftData連携

### デバッグ情報
- **ログ出力**: 主要操作のログ記録
- **エラーハンドリング**: 適切なエラー表示
- **状態監視**: データの状態変化追跡