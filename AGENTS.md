# AGENTS.md

Guidance for AI coding agents working in this repository.

## Project overview

- **App**: BabySteps (iOS)
- **UI**: SwiftUI
- **Data**: SwiftData
- **Architecture**: MVVM (Views → ViewModels → Models)
- **Project generation**: XcodeGen (`project.yml` → `BabySteps.xcodeproj`)
- **CI runners**: macOS 26 with Xcode 26.0 (see `.github/workflows/`)

## Repository layout

- **Source**: `Sources/`
  - `Sources/App/`: app entry point
  - `Sources/Models/`: SwiftData models and domain types
  - `Sources/ViewModels/`: app logic/state
  - `Sources/Views/`: SwiftUI UI
  - `Sources/Info.plist`
  - `Sources/PrivacyInfo.xcprivacy`
- **Tests**: `Tests/` (unit tests)
- **Project spec**: `project.yml` (XcodeGen)
- **Docs**:
  - `README.md`
  - `GITHUB_ACTIONS_SETUP.md` (TestFlight workflow setup)
  - `SCREENSHOT_GENERATION.md` (App Store screenshots automation)

## Quick start (local development)

This repo expects you to generate the Xcode project from `project.yml`.

```bash
# Generate Xcode project
brew install xcodegen
xcodegen generate

# Open in Xcode
open BabySteps.xcodeproj
```

## Build & test (CLI)

CI builds against an iOS 26.2 simulator and disables code signing for simulator builds.

```bash
# Debug build (simulator)
xcodebuild -project BabySteps.xcodeproj \
  -scheme BabySteps \
  -sdk iphonesimulator \
  -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.2' \
  -derivedDataPath build \
  -configuration Debug \
  CODE_SIGNING_ALLOWED=NO \
  build

# Unit tests (simulator)
xcodebuild -project BabySteps.xcodeproj \
  -scheme BabySteps \
  -sdk iphonesimulator \
  -destination 'platform=iOS Simulator,name=iPhone 17 Pro,OS=26.2' \
  -derivedDataPath build \
  -configuration Debug \
  CODE_SIGNING_ALLOWED=NO \
  test
```

Notes:

- If simulator device names or iOS runtime versions change, update the `-destination` values (and keep CI in sync).
- The CI workflow fails the job when tests fail; ensure tests are reliable before merging.

## Formatting

### Swift (`swift-format`)

The repo includes a `.swift-format` configuration and CI provides a formatting patch on PRs.

```bash
brew install swift-format
swift-format format --in-place . --configuration .swift-format
```

### Markdown (`markdownlint`)

Markdown lint is enforced for `*.md` and `*.mdc` using `.markdownlint.json`.

```bash
npm install -g markdownlint-cli
markdownlint '**/*.md' '**/*.mdc' --fix
```

**Before pushing**: Run `markdownlint '**/*.md' '**/*.mdc'` and ensure it passes with no errors. Fix any reported issues before committing and pushing.

## CI workflows (what to keep in mind)

Workflows live in `.github/workflows/`:

- **Build & Test**: `ios-build.yml` (generates project via XcodeGen, builds Debug/Release, runs tests, archives unsigned)
- **TestFlight**: `ios-build-testflight.yml` (archives unsigned then exports/signs using App Store Connect API key + ExportOptions)
- **Screenshots**: `generate-screenshots.yml` (boots simulators, installs app, takes screenshots)
- **Formatting patch**: `format-patch.yml` (posts a diff for Swift/Markdown formatting)
- **Markdown lint**: `markdownlint.yml`

## Adding/renaming files

Because the project is generated by XcodeGen:

- Add new Swift files under the correct folder in `Sources/` (or `Tests/` for tests).
- Ensure they are included by the `Sources`/`Tests` directories referenced in `project.yml`.
- Re-run `xcodegen generate` after structural changes.

## Architecture & coding conventions

- **Views**: keep UI-focused; avoid business logic and persistence orchestration.
- **ViewModels**: own state and actions; prefer testable, deterministic logic.
- **Models**: SwiftData models and domain rules.
- **Naming**:
  - Views: `SomethingView`
  - ViewModels: `SomethingViewModel`
- **Safety**:
  - Avoid force unwrap (`!`) and `try!`.
  - Keep files with a trailing newline.

## Secrets & signing

- Do **not** commit credentials, API keys, certificates, or provisioning profiles.
- TestFlight automation expects secrets described in `GITHUB_ACTIONS_SETUP.md`.
